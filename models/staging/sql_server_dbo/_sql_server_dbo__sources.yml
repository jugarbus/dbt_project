sources:
  - name: sql_server_dbo  
    schema: sql_server_dbo  
    database: "{{ env_var('DBT_ENVIRONMENTS') }}_BRONZE_DB"

    quoting:
      database: false
      schema: false
      identifier: false

    freshness:
      warn_after: {count: 1000, period: day}
      error_after: {count: 1100, period: day}

    tables:

      - name: products
        description: "Tabla que contiene la información de los productos disponibles en el sistema, incluyendo su precio, inventario y metadatos de sincronización."
        loaded_at_field: _fivetran_synced

        columns:
          - name: product_id
            description: "Identificador único del producto (Primary Key). Cada registro en la tabla corresponde a un producto distinto."

          - name: price
            description: "Precio actual del producto expresado en dólares estadounidenses (USD)."

          - name: name
            description: "Nombre o descripción comercial del producto, tal como aparece en el catálogo de origen."

          - name: inventory
            description: "Cantidad disponible en inventario para el producto. Representa el stock actual registrado en el sistema fuente."

          - name: _fivetran_deleted
            description: "Indicador booleano utilizado por Fivetran para marcar registros que fueron eliminados en el sistema fuente. Si es 'true', el registro ya no existe en origen."

          - name: _fivetran_synced
            description: "Marca de tiempo de la última sincronización realizada por Fivetran."



      - name: promos
        description: "Tabla que contiene información sobre las promociones activas y su descuento aplicado."
        loaded_at_field: _fivetran_synced
        columns:
          - name: promo_id
            description: "Descripción de la promoción. No es id, es un string."
            tests:
              - not_null
              - unique

          - name: discount
            description: "Valor en dólares del descuento aplicado en la promoción."
            tests:
              - not_null


          - name: status
            description: "Estado actual de la promoción (active o inactive)."
            tests:
              - not_null
              - accepted_values:
                  values: ['active', 'inactive']

          - name: _fivetran_deleted
            description: "Indica si la fila fue eliminada en el sistema de origen (true/false)."


          - name: _fivetran_synced
            description: "Marca de tiempo de la última sincronización realizada por Fivetran."
            tests:
              - not_null


      - name: users
        loaded_at_field: _fivetran_synced
        columns:
          - name: user_id
          - name: updated_at
          - name: address_id
          - name: last_name
          - name: created_at
          - name: phone_number
          - name: total_orders
          - name: first_name
          - name: email
          - name: _fivetran_deleted
          - name: _fivetran_synced

      - name: orders
        description: "Tabla que almacena la información de los pedidos realizados por los usuarios."
        loaded_at_field: _fivetran_synced

        columns:
          - name: order_id
            description: "Identificador único del pedido (Primary Key). Cada registro representa una transacción o compra realizada por un usuario."

          - name: shipping_service
            description: "Nombre del servicio de envío utilizado para entregar el pedido (por ejemplo: UPS, FedEx, DHL)."

          - name: shipping_cost
            description: "Costo asociado al envío del pedido. Expresado en dólares estadounidenses (USD)."

          - name: address_id
            description: "Identificador del domicilio de entrega del pedido. Es una clave foránea que hace referencia a la tabla 'addresses'."

          - name: created_at
            description: "Marca de tiempo (timestamp) que indica la fecha y hora en que se creó el pedido."

          - name: delivered_at
            description: "Marca de tiempo (timestamp) que indica la fecha y hora en que el pedido fue entregado al cliente."

          - name: estimated_delivery_at
            description: "Fecha y hora estimadas de entrega del pedido, proporcionadas al momento de la compra."

          - name: promo_id
            description: "Identificador de la promoción aplicada al pedido, si corresponde. Clave foránea que referencia a la tabla 'promos'."

          - name: order_cost
            description: "Costo base del pedido antes de aplicar impuestos, descuentos o cargos de envío."

          - name: user_id
            description: "Identificador del usuario que realizó el pedido. Clave foránea que referencia a la tabla 'users'."

          - name: order_total
            description: "Importe total final del pedido, incluyendo descuentos, promociones y gastos de envío."

          - name: tracking_id
            description: "Número de seguimiento proporcionado por el servicio de envío para rastrear el estado del pedido."

          - name: status
            description: "Estado actual del pedido (por ejemplo: 'delivered', 'preparing', 'shipped')."

          - name: _fivetran_deleted
            description: "Indicador booleano utilizado por Fivetran para marcar los registros que fueron eliminados en el sistema fuente. Si es 'true', el pedido ya no existe en el origen."

          - name: _fivetran_synced
            description: "Marca de tiempo (timestamp) que indica cuándo el registro fue sincronizado desde el sistema fuente mediante Fivetran. Usada para control de carga y frescura de los datos."


      - name: addresses
        loaded_at_field: _fivetran_synced
        columns:
          - name: address_id
          - name: zipcode
          - name: country
          - name: address
          - name: state
          - name: _fivetran_deleted
          - name: _fivetran_synced

      - name: events
        loaded_at_field: _fivetran_synced


      - name: order_items
        loaded_at_field: _fivetran_synced

